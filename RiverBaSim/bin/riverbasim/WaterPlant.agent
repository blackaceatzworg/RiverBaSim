<?xml version="1.0" encoding="UTF-8"?>
<agent version="1" agentcomment="This is an agent." agentclassname="WaterPlant" agentparentclassname="riverbasim.WaterHolder" agentinterfaces="" agentimports="">
  <behaviorsteps>
    <behaviorstep x="89" y="82" scheduleannotationstart="1" scheduleannotationpick="" scheduleannotationinterval="1" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="1" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Dumping water beyond capacity" visibility="0" returntype="" compiledname="overloadDump" parameters="" exceptions="">
      <label x="89" y="67" text="Dumping water beyond capacity"/>
    </behaviorstep>
    <behaviorstep x="593" y="54" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Treating wastewater" visibility="0" returntype="def" compiledname="wastewaterTreatement" parameters="" exceptions="">
      <label x="570" y="40" text="Wastewater treatement"/>
    </behaviorstep>
  </behaviorsteps>
  <tasksteps>
    <taskstep x="107" y="325" comment="Dump surplus water to river" command1="double waterToRiver = amountWater.get(GetTickCount())-capacity;\fdouble solidToRiver = solidConcentration.get(GetTickCount())*0.01;\fdouble bodToRiver = bodConcentration.get(GetTickCount())*0.01;\fdouble codToRiver =codConcentration.get(GetTickCount())*0.1:\fdouble ntToRiver = ntConcentration.get(GetTickCount())*0.02\fdouble ptToRiver = ptConcentration.get(GetTickCount())*0.3;\friverSectionLocation.mixIncomingWater(waterToRiver, solidToRiver, bodToRiver, ntToRiver, ptToRiver);\famountWater.put(GetTickCount(), capacity);" command2="" command3="" command4="" command5="">
      <label x="70" y="378" text="Dump surplus water to river"/>
    </taskstep>
    <taskstep x="546" y="380" comment="Remove pollutants if there&apos;s no remaining water" command1="solidConcentration.put(GitTickCount(), 0);" command2="bodConcentration.put(GitTickCount(), 0);" command3="codConcentration.put(GitTickCount(), 0);" command4="ntConcentration.put(GitTickCount(), 0);" command5="ptConcentration.put(GitTickCount(), 0);">
      <label x="469" y="363" text="Set pollutants to zero if there is no more water in the WWTP"/>
    </taskstep>
    <taskstep x="593" y="164" comment="Cleans N units of wastewater" command1="double waterToRiver = amountWater.get(GetTickCount());\fif (capacity&lt; waterToRiver) {\f waterToRiver = capacity;\f}\fdouble solidToRiver = solidConcentration.get(GetTickCount())*0.01;\fdouble bodToRiver = bodConcentration.get(GetTickCount())*0.01;\fdouble codToRiver =codConcentration.get(GetTickCount())*0.1:\fdouble ntToRiver = ntConcentration.get(GetTickCount())*0.02\fdouble ptToRiver = ptConcentration.get(GetTickCount())*0.3;\friverSectionLocation.mixIncomingWater(waterToRiver, solidToRiver, bodToRiver, ntToRiver, ptToRiver);\famountWater.put(GetTickCount(), amountWater.get(GetTickCount()) - waterToRiver);" command2="" command3="" command4="" command5="">
      <label x="497" y="180" text="CleanWasteWater"/>
    </taskstep>
  </tasksteps>
  <decisionsteps>
    <decisionstep x="593" y="259" comment="This is an agent decision." criteria="amountWater.get(GetTickCount())==0" branchType="if">
      <label x="593" y="244" text="Evaluate Criteria"/>
    </decisionstep>
    <decisionstep x="103" y="175" comment="This is an agent decision." criteria="amountWater.get(GetTickCount())&gt;capacity" branchType="if">
      <label x="103" y="160" text="Overload?"/>
    </decisionstep>
  </decisionsteps>
  <joinsteps>
    <joinstep x="297" y="362"/>
    <joinstep x="693" y="516"/>
  </joinsteps>
  <agentproperties>
    <agentproperty x="130" y="533" comment="River section where the WWTP dumps treated water." visibility="0" compiledname="riverSectionLocation" type="RiverSection" defaultvalue="null">
      <label x="135" y="518" text="River section location"/>
    </agentproperty>
    <agentproperty x="127" y="458" comment="Flow (amount) of water" visibility="0" compiledname="amountWater" type="riverbasim.WaterFeature" defaultvalue="new riverbasim.WaterFeature(GetTickCount(), 0)">
      <label x="183" y="469" text="Amount of water (m3)&quot;, converter = &quot;riverbasim.WaterFeatureConverter"/>
    </agentproperty>
    <agentproperty x="132" y="602" comment="Treatement capacity of the WWTP" visibility="0" compiledname="capacity" type="double" defaultvalue="50000">
      <label x="137" y="587" text="Capacity"/>
    </agentproperty>
  </agentproperties>
  <endsteps>
    <endstep x="300" y="433"/>
    <endstep x="703" y="601"/>
  </endsteps>
  <connections>
    <transitions>
      <transition>
        <transitionsource type="behavior" index="0" anchor="0"/>
        <transitiontarget type="decision" index="1" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="1" anchor="0"/>
        <transitiontarget type="task" index="2" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="0" anchor="3"/>
        <transitiontarget type="join" index="0" anchor="1"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="1" anchor="2"/>
        <transitiontarget type="join" index="1" anchor="1"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="2" anchor="2"/>
        <transitiontarget type="decision" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="join" index="0" anchor="2"/>
        <transitiontarget type="end" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="join" index="1" anchor="2"/>
        <transitiontarget type="end" index="1" anchor="0"/>
        <bendpoints/>
      </transition>
    </transitions>
    <booleantransitions>
      <booleantransition value="true">
        <transitionsource type="decision" index="0" anchor="2"/>
        <transitiontarget type="task" index="1" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="0" anchor="3"/>
        <transitiontarget type="join" index="1" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="1" anchor="2"/>
        <transitiontarget type="task" index="0" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="1" anchor="3"/>
        <transitiontarget type="join" index="0" anchor="0"/>
        <bendpoints/>
      </booleantransition>
    </booleantransitions>
  </connections>
</agent>