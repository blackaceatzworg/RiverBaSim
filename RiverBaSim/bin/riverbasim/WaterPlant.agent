<?xml version="1.0" encoding="UTF-8"?>
<agent version="1" agentcomment="This is an agent." agentclassname="WaterPlant" agentparentclassname="riverbasim.WaterHolder" agentinterfaces="" agentimports="">
  <behaviorsteps>
    <behaviorstep x="578" y="39" scheduleannotationstart="" scheduleannotationpick="" scheduleannotationinterval="" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="0" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Treating wastewater" visibility="0" returntype="def" compiledname="wastewaterTreatement" parameters="" exceptions="">
      <label x="555" y="25" text="Wastewater treatement"/>
    </behaviorstep>
    <behaviorstep x="95" y="66" scheduleannotationstart="1" scheduleannotationpick="" scheduleannotationinterval="1" scheduleannotationpriority="" scheduleannotationduration="" scheduleannotationshuffle="1" watchannotationid="" watchannotationquery="" watchannotationtargetclassname="" watchannotationtargetfieldnames="" watchannotationtriggercondition="" watchannotationtriggerschedule="1" watchannotationtriggerdelta="1" watchannotationtriggerpriority="" watchannotationpick="" comment="Dumping water beyond capacity" visibility="0" returntype="" compiledname="overloadDump" parameters="" exceptions="">
      <label x="95" y="51" text="Dumping water beyond capacity"/>
    </behaviorstep>
  </behaviorsteps>
  <tasksteps>
    <taskstep x="578" y="149" comment="Cleans N units of wastewater" command1="double waterToRiver = amountWater.get(GetTickCount());\fif (capacity&lt; waterToRiver) {\f waterToRiver = capacity;\f}\fdouble solidToRiver = solidConcentration.get(GetTickCount())*0.01;\fdouble bodToRiver = bodConcentration.get(GetTickCount())*0.01;\fdouble codToRiver =codConcentration.get(GetTickCount())*0.1:\fdouble ntToRiver = ntConcentration.get(GetTickCount())*0.02\fdouble ptToRiver = ptConcentration.get(GetTickCount())*0.3;\friverSectionLocation.mixIncomingWater(waterToRiver, solidToRiver, bodToRiver, ntToRiver, ptToRiver);\famountWater.put(GetTickCount(), amountWater.get(GetTickCount()) - waterToRiver);" command2="" command3="" command4="" command5="">
      <label x="482" y="165" text="CleanWasteWater"/>
    </taskstep>
    <taskstep x="531" y="365" comment="Remove pollutants if there&apos;s no remaining water" command1="solidConcentration.put(GitTickCount(), 0);" command2="bodConcentration.put(GitTickCount(), 0);" command3="codConcentration.put(GitTickCount(), 0);" command4="ntConcentration.put(GitTickCount(), 0);" command5="ptConcentration.put(GitTickCount(), 0);">
      <label x="454" y="348" text="Set pollutants to zero if there is no more water in the WWTP"/>
    </taskstep>
    <taskstep x="92" y="310" comment="Dump surplus water to river" command1="double waterToRiver = amountWater.get(GetTickCount())-capacity;\fdouble solidToRiver = solidConcentration.get(GetTickCount())*0.01;\fdouble bodToRiver = bodConcentration.get(GetTickCount())*0.01;\fdouble codToRiver =codConcentration.get(GetTickCount())*0.1:\fdouble ntToRiver = ntConcentration.get(GetTickCount())*0.02\fdouble ptToRiver = ptConcentration.get(GetTickCount())*0.3;\friverSectionLocation.mixIncomingWater(waterToRiver, solidToRiver, bodToRiver, ntToRiver, ptToRiver);\famountWater.put(GetTickCount(), capacity);" command2="" command3="" command4="" command5="">
      <label x="55" y="363" text="Dump surplus water to river"/>
    </taskstep>
  </tasksteps>
  <decisionsteps>
    <decisionstep x="88" y="160" comment="This is an agent decision." criteria="amountWater.get(GetTickCount())&gt;capacity" branchType="if">
      <label x="88" y="145" text="Overload?"/>
    </decisionstep>
    <decisionstep x="578" y="244" comment="This is an agent decision." criteria="amountWater.get(GetTickCount())==0" branchType="if">
      <label x="578" y="229" text="Evaluate Criteria"/>
    </decisionstep>
  </decisionsteps>
  <joinsteps>
    <joinstep x="663" y="486"/>
    <joinstep x="267" y="332"/>
  </joinsteps>
  <agentproperties>
    <agentproperty x="839" y="156" comment="River section where the WWTP dumps treated water." visibility="0" compiledname="riverSectionLocation" type="RiverSection" defaultvalue="null">
      <label x="844" y="141" text="River section location"/>
    </agentproperty>
    <agentproperty x="841" y="225" comment="Treatement capacity of the WWTP" visibility="0" compiledname="capacity" type="double" defaultvalue="50000">
      <label x="846" y="210" text="Capacity"/>
    </agentproperty>
    <agentproperty x="836" y="81" comment="Flow (amount) of water" visibility="0" compiledname="amountWater" type="riverbasim.WaterFeature" defaultvalue="new riverbasim.WaterFeature(GetTickCount(), 0)">
      <label x="892" y="92" text="Amount of water (m3)&quot;, converter = &quot;riverbasim.WaterFeatureConverter"/>
    </agentproperty>
  </agentproperties>
  <endsteps>
    <endstep x="673" y="571"/>
    <endstep x="270" y="403"/>
  </endsteps>
  <connections>
    <transitions>
      <transition>
        <transitionsource type="behavior" index="0" anchor="0"/>
        <transitiontarget type="task" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="behavior" index="1" anchor="0"/>
        <transitiontarget type="decision" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="0" anchor="2"/>
        <transitiontarget type="decision" index="1" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="1" anchor="2"/>
        <transitiontarget type="join" index="0" anchor="1"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="task" index="2" anchor="3"/>
        <transitiontarget type="join" index="1" anchor="1"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="join" index="0" anchor="2"/>
        <transitiontarget type="end" index="0" anchor="0"/>
        <bendpoints/>
      </transition>
      <transition>
        <transitionsource type="join" index="1" anchor="2"/>
        <transitiontarget type="end" index="1" anchor="0"/>
        <bendpoints/>
      </transition>
    </transitions>
    <booleantransitions>
      <booleantransition value="true">
        <transitionsource type="decision" index="0" anchor="2"/>
        <transitiontarget type="task" index="2" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="0" anchor="3"/>
        <transitiontarget type="join" index="1" anchor="0"/>
        <bendpoints>
          <bendpoint x="266" y="187"/>
        </bendpoints>
      </booleantransition>
      <booleantransition value="true">
        <transitionsource type="decision" index="1" anchor="2"/>
        <transitiontarget type="task" index="1" anchor="0"/>
        <bendpoints/>
      </booleantransition>
      <booleantransition value="false">
        <transitionsource type="decision" index="1" anchor="3"/>
        <transitiontarget type="join" index="0" anchor="0"/>
        <bendpoints/>
      </booleantransition>
    </booleantransitions>
  </connections>
</agent>