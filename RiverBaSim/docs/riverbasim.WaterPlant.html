<HTML><FONT FACE=Arial, Verdana, Sans><TITLE>WaterPlant.agent</TITLE><BODY><STYLE TYPE="text/css"><!--.centeralign <BLOCKQUOTE>text-align:center</BLOCKQUOTE>--></STYLE><HEAD><P CLASS="centeralign">WaterPlant.agent</P></HEAD><IMG SRC=images/riverbasim.WaterPlant.png border=1 alt="Flowchart for WaterPlant.agent" title="Flowchart for WaterPlant.agent"></P>The package name is "riverbasim".</p>
The following external code is referenced:<BLOCKQUOTE></p>
<li>Components from java.io.*</li></p>
<li>Components from java.math.*</li></p>
<li>Components from java.util.*</li></p>
<li>Components from javax.measure.unit.*</li></p>
<li>Components from org.jscience.mathematics.number.*</li></p>
<li>Components from org.jscience.mathematics.vector.*</li></p>
<li>Components from org.jscience.physics.amount.*</li></p>
<li>Components from repast.simphony.adaptation.neural.*</li></p>
<li>Components from repast.simphony.adaptation.regression.*</li></p>
<li>Components from repast.simphony.context.*</li></p>
<li>Components from repast.simphony.context.space.continuous.*</li></p>
<li>Components from repast.simphony.context.space.gis.*</li></p>
<li>Components from repast.simphony.context.space.graph.*</li></p>
<li>Components from repast.simphony.context.space.grid.*</li></p>
<li>Components from repast.simphony.engine.environment.*</li></p>
<li>Components from repast.simphony.engine.schedule.*</li></p>
<li>Components from repast.simphony.engine.watcher.*</li></p>
<li>Components from repast.simphony.groovy.math.*</li></p>
<li>Components from repast.simphony.integration.*</li></p>
<li>Components from repast.simphony.matlab.link.*</li></p>
<li>Components from repast.simphony.query.*</li></p>
<li>Components from repast.simphony.query.space.continuous.*</li></p>
<li>Components from repast.simphony.query.space.gis.*</li></p>
<li>Components from repast.simphony.query.space.graph.*</li></p>
<li>Components from repast.simphony.query.space.grid.*</li></p>
<li>Components from repast.simphony.query.space.projection.*</li></p>
<li>Components from repast.simphony.parameter.*</li></p>
<li>Components from repast.simphony.random.*</li></p>
<li>Components from repast.simphony.space.continuous.*</li></p>
<li>Components from repast.simphony.space.gis.*</li></p>
<li>Components from repast.simphony.space.graph.*</li></p>
<li>Components from repast.simphony.space.grid.*</li></p>
<li>Components from repast.simphony.space.projection.*</li></p>
<li>Components from repast.simphony.ui.probe.*</li></p>
<li>Components from repast.simphony.util.*</li></p>
<li>Components from simphony.util.messages.*</li></p>
<li>Components from static java.lang.Math.*</li></p>
<li>Components from static repast.simphony.essentials.RepastEssentials.*</li></p>
</BLOCKQUOTE><P></p>
The class "WaterPlant" is defined with visibility "public" which extends parent class "riverbasim.WaterHolder" . This is an agent.</p>
 <BLOCKQUOTE></p>
</p>
    <li>There is a field named "riverSectionLocation" with visibility "public" of type "RiverSection" and default value null. River section where the WWTP dumps treated water. The block is tagged with the name "River section location".</li></p>
</p>
    <li>There is a field named "amountWater" with visibility "public" of type "double" and default value 0. Flow (amount) of water The block is tagged with the name "Amount of water (m3)".</li></p>
</p>
    <li>There is a field named "capacity" with visibility "public" of type "double" and default value 50000. Treatement capacity of the WWTP The block is tagged with the name "Capacity".</li></p>
</p>
    <li>There is a field named "bodConcentration" with visibility "public" of type "double" and default value 0. Concentration of BOD The block is tagged with the name "BOD concentration (gr./m3)".</li></p>
</p>
    <li>There is a field named "solidConcentration" with visibility "public" of type "double" and default value 0. Concentration of solids (MES) The block is tagged with the name "Solid concentration (gr/m3)".</li></p>
</p>
    <li>There is a field named "ntConcentration" with visibility "public" of type "double" and default value 0. Concentration of Nt The block is tagged with the name "Nitrogen Total concentration".</li></p>
</p>
    <li>There is a field named "ptConcentration" with visibility "public" of type "double" and default value 0. Concentration of Phosphorus Total The block is tagged with the name "Phosphorus Total concentration".</li></p>
</p>
    <li>There is a field named "codConcentration" with visibility "public" of type "double" and default value 0. Concentration of COD The block is tagged with the name "COD concentration (gr./m3)".</li></p>
</p>
    <li>There is a field named "alertLevel" with visibility "public" of type "double" and default value 0. Alert mode: the WWTP is dumping water The block is tagged with the name "Alert level".</li></p>
</p>
    </p>
    </p>
        <li>There is a method named "overloadDump" method has visibility     "public". Dumping water beyond capacity The block is tagged with the name "Dumping water beyond capacity".</li></p>
    </p>
    </p>
    <BLOCKQUOTE>The overloadDump method is statically scheduled as follows:<BLOCKQUOTE></p>
        <li>start = 1d</li></p>
        <li>interval = 1d</li></p>
        <li>shuffle = false</li></p>
    </BLOCKQUOTE></BLOCKQUOTE></p>
 <BLOCKQUOTE>The code for the "overloadDump" method is as follows:<BLOCKQUOTE><CODE></p>
</p>
</p>
         Note the simulation time.</p>
        def time = GetTickCountInTimeUnits()</p>
</p>
</p>
         This is an agent decision.</p>
        if (amountWater>capacity) <BLOCKQUOTE></p>
</p>
             Dump surplus water to river</p>
            Double amountToSend = new Double(amountWater-capacity)</p>
            riverSectionLocation.mixIncomingWater(amountToSend, new Double(solidConcentration), new Double(bodConcentration), new Double(ntConcentration), new Double(ptConcentration))</p>
            setAmountWater(capacity)</p>
</p>
        </BLOCKQUOTE> else  <BLOCKQUOTE></p>
</p>
</p>
        </BLOCKQUOTE></p>
         End the method.</p>
        return</p>
</p>
    </BLOCKQUOTE></BLOCKQUOTE></CODE></p>
</p>
</p>
    </p>
    </p>
        <li>There is a method named "wastewaterTreatement" method has visibility     "public" has return type "def". Treating wastewater The block is tagged with the name "Wastewater treatement".</li></p>
    </p>
    </p>
 <BLOCKQUOTE>The code for the "wastewaterTreatement" method is as follows:<BLOCKQUOTE><CODE></p>
</p>
</p>
         Define the return value variable.</p>
        def returnValue</p>
</p>
         Note the simulation time.</p>
        def time = GetTickCountInTimeUnits()</p>
</p>
         Cleans N units of wastewater</p>
        double waterToRiver = amountWater;</p>
        if (capacity< waterToRiver) <BLOCKQUOTE></p>
         waterToRiver = capacity;</p>
        </BLOCKQUOTE></p>
        double solidToRiver = solidConcentration*0.01;</p>
        double bodToRiver = bodConcentration*0.01;</p>
        double codToRiver =codConcentration*0.1;</p>
        double ntToRiver = ntConcentration*0.02;</p>
        double ptToRiver = ptConcentration*0.3;</p>
        riverSectionLocation.mixIncomingWater(waterToRiver, solidToRiver, bodToRiver, ntToRiver, ptToRiver);</p>
        amountWater -=waterToRiver;</p>
</p>
         This is an agent decision.</p>
        if (amountWater==0) <BLOCKQUOTE></p>
</p>
             Remove pollutants if there's no remaining water</p>
            setSolidConcentration(0;)</p>
            setBodConcentration(0;)</p>
            setCodConcentration(0;)</p>
            setNtConcentration(0;)</p>
            setPtConcentration(0;)</p>
</p>
        </BLOCKQUOTE> else  <BLOCKQUOTE></p>
</p>
</p>
        </BLOCKQUOTE></p>
         Return the results.</p>
        return returnValue</p>
</p>
    </BLOCKQUOTE></BLOCKQUOTE></CODE></p>
</p>
</p>
    </p>
    </p>
        <li>There is a method named "mixIncomingWater" method has visibility     "public" has return type "def" and parameters [amountWaterReceived, solidConcentrationReceived, bodConcentrationReceived, codConcentrationReceived, ntConcentrationReceived, ptConcentrationReceived]. Mixing water The block is tagged with the name "Receives a mass of water to be mixed with the current water in the Water holder".</li></p>
    </p>
    </p>
 <BLOCKQUOTE>The code for the "mixIncomingWater" method is as follows:<BLOCKQUOTE><CODE></p>
</p>
</p>
         Define the return value variable.</p>
        def returnValue</p>
</p>
         Note the simulation time.</p>
        def time = GetTickCountInTimeUnits()</p>
</p>
         Mix water</p>
        setSolidConcentration((solidConcentration*amountWater+solidConcentrationReceived*amountWaterReceived)/(amountWater+amountWaterReceived);</p>
        bodConcentration= (bodConcentration*amountWater+bodConcentrationReceived*amountWaterReceived)/(amountWater+amountWaterReceived);</p>
        codConcentration= (codConcentration*amountWater+codConcentrationReceived*amountWaterReceived)/(amountWater+amountWaterReceived);</p>
        ntConcentration= (ntConcentration*amountWater+ntConcentrationReceived*amountWaterReceived)/(amountWater+amountWaterReceived);</p>
        ptConcentration= (ptConcentration*amountWater+ptConcentrationReceived*amountWaterReceived)/(amountWater+amountWaterReceived);</p>
        amountWater+= amountWaterReceived;)</p>
         Return the results.</p>
        return returnValue</p>
</p>
    </BLOCKQUOTE></BLOCKQUOTE></CODE></p>
</p>
</p>
    </p>
    </p>
        <li>There is a method named "alertLevel" method has visibility     "public" has return type "def". Update alert level The block is tagged with the name "Measure alert level".</li></p>
    </p>
    </p>
    <BLOCKQUOTE>The alertLevel method is statically scheduled as follows:<BLOCKQUOTE></p>
        <li>start = 1d</li></p>
        <li>interval = 1d</li></p>
        <li>shuffle = false</li></p>
    </BLOCKQUOTE></BLOCKQUOTE></p>
 <BLOCKQUOTE>The code for the "alertLevel" method is as follows:<BLOCKQUOTE><CODE></p>
</p>
</p>
         Define the return value variable.</p>
        def returnValue</p>
</p>
         Note the simulation time.</p>
        def time = GetTickCountInTimeUnits()</p>
</p>
         Measure alert level</p>
        setAlertLevel(min(2, amountWater/capacity))</p>
         Return the results.</p>
        return returnValue</p>
</p>
    </BLOCKQUOTE></BLOCKQUOTE></CODE></p>
</p>
</p>
</p>
</BLOCKQUOTE></p>
</p>
</BODY></HTML>